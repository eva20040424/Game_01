:: Start
/* CSS: 讓這個頁面的文字置中，看起來像標題頁 */
<div style="text-align: center; margin-top: 5%;">
    <h1>✦ 初始設定 ✦</h1>
    <hr style="width: 50%; border-color: #ff69b4;">
    
    <p>歡迎來到《慾門》</p>
    <p>在意識沉入肉體之前，請確認妳的身份資訊</p>

    /* --- 輸入區塊 (深色背景框) --- */
    <div style="background-color: #333; padding: 20px; border-radius: 10px; display: inline-block; text-align: left; width: 300px;">
        
        /* 名字輸入框 */
        <p><b>📇 本名：</b> <br>
        <<textbox "$name" "恬羽">></p>
        
        /* 暱稱輸入框 */
        <p><b>🏷️ 暱稱：</b> <br>
        <<textbox "$nick" "羽兒">></p>

        <hr style="border-style: dashed; opacity: 0.3;">

        /* --- AI 連結設定 (新增區塊) --- */
        <p style="color: #66ccff;"><b>🤖 AI 連結設定 (Google AI Studio)</b></p>
        
        /* 模型選擇 */
        <p style="font-size: 0.9em;"><b>🧠 模型選擇：</b><br>
        <<listbox "$aiModel" autoselect>>
            <<option "Gemini 3 Flash (快速)" "gemini-3-flash-preview">>
            <<option "Gemini 3 Pro (強大)" "gemini-3-pro-preview">>
        <</listbox>></p>

        /* 金鑰管理：選擇舊有或輸入新增 */
        <p style="font-size: 0.9em;"><b>🔑 API 金鑰管理：</b><br>
        
        /* 1. 若有存檔金鑰，顯示切換選單 */
        <<if $keyVault.length > 0>>
            <span style="font-size:0.8em; color:#aaa;">－ 從儲存庫切換：</span><br>
            <<listbox "$apiKey" autoselect>>
                <<optionsfrom $keyVault>>
            <</listbox>>
            
            /* 【修正點 1】使用 memorize 函數來記憶 */
            <<button "✅ 確認切換">>
                <<run memorize("apiKey", $apiKey)>>
                <<run memorize("aiModel", $aiModel)>>
                <<run UI.alert("已切換並記憶金鑰！")>>
            <</button>>
            <br>
        <</if>>
        
        /* 2. 新增金鑰輸入框 */
        <span style="font-size:0.8em; color:#aaa;">－ 或輸入新金鑰：</span><br>
        <<textbox "_newKey" "">> 
        
        /* 【修正點 2】使用 memorize 函數來永久記憶 */
        <<button "💾 存入並永久記憶">>
            <<if _newKey neq "">>
                /* 1. 更新金鑰庫 */
                <<run $keyVault.pushUnique(_newKey)>>
                
                /* 2. 設定當前金鑰 */
                <<set $apiKey to _newKey>>
                
                /* 3. 將資料寫入瀏覽器硬碟 (Key, Value) */
                <<run memorize("apiKey", $apiKey)>>
                <<run memorize("keyVault", $keyVault)>>
                <<run memorize("aiModel", $aiModel)>>

                <<goto "Start">> /* 刷新頁面 */
            <</if>>
        <</button>>
        </p>
    
    /* 按鈕：前往下一個場景 */
歡迎來到測試房。
[[開始 AI 互動->Action_Handler][$player_act = "玩家醒來，觀察四周"]]
[[測試真假->Action_Handler][$player_act = "請告訴我 123 乘以 456 等於多少"]]

</div>