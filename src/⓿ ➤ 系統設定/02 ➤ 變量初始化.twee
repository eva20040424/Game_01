:: StoryInit

/* 1. 角色名稱設定 */
<<set $name to "">> /* 預設本名 */
<<set $nick to "">> /* 預設暱稱 */

/* 2. 身體數值設定 */
<<set $bladder to 0>> /* 膀胱容量 */
<<set $money to 100>> /* 金錢 */

/* 3. 時間系統 */
<<set $startYear to 2025>> /* 借用2025但仍顯示第1年 */
<<set $gameDate to new Date("2025-08-31T07:00:00")>>

/* 4. AI 連結設定 */
/* 使用 recall("變數名稱", 預設值) 從瀏覽器記憶中讀取資料 */

/* 嘗試讀取 apiKey，如果沒讀到，就設為空字串 "" */
<<set $apiKey to recall("apiKey", "")>>

/* 嘗試讀取金鑰庫，如果沒讀到，就設為空陣列 [] */
<<set $keyVault to recall("keyVault", [])>>

/* 嘗試讀取模型設定，如果沒讀到，就設為預設模型 */
<<set $aiModel to recall("aiModel", "gemini-3-flash-preview")>>

/* 系統指令通常不需永久記憶 */
<<set $systemPrompt to "">>

/* 5. 角色與世界資料庫 */
<<script>>
    /* 如果倉庫還沒蓋好，就蓋一個空的；如果已經由其他檔案蓋好了，就保留原狀 */
    setup.chars = setup.chars || {};
    setup.lore = setup.lore || {};
<</script>>

/* --- 6. 圖書管理系統初始化 (包含風格預設) --- */
<<set $custom_chars to recall("custom_chars", {})>>
<<set $custom_lore to recall("custom_lore", {})>>
<<set $custom_presets to recall("custom_presets", {})>>

/* 當前掛載列表 */
<<set $active_char_ids to ["恬羽"]>>
<<set $active_world_ids to ["隨身空間"]>>
<<set $active_preset_id to recall("active_preset_id", "系統原廠")>>

/* 強制鎖定膀胱下限 */
<<if $sys_bladder_ml < 2000>>
    <<set $sys_bladder_ml to 2000>>
<</if>>